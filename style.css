/* ---------- Variáveis ---------- */
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#222;
  --muted:#6b7280;
  --primary:#25D366;
  --danger:#ef4444;
  --border:#e5e7eb;
  --shadow:0 4px 14px rgba(0,0,0,.08);

  --prio-low:#d1fae5;   /* verde claro */
  --prio-med:#fef3c7;   /* amarelo claro */
  --prio-high:#fee2e2;  /* vermelho claro */
  --prio-low-border:#10b981;
  --prio-med-border:#f59e0b;
  --prio-high-border:#ef4444;
}

html[data-theme="dark"]{
  --bg:#0f1115;
  --card:#151922;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --primary:#25D366;
  --danger:#ef4444;
  --border:#273043;
  --shadow:0 8px 20px rgba(0,0,0,.45);

  --prio-low:#0e2a1f;
  --prio-med:#2b2614;
  --prio-high:#2a1616;
  --prio-low-border:#10b981;
  --prio-med-border:#f59e0b;
  --prio-high-border:#ef4444;
}

*{ box-sizing:border-box; }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  line-height:1.4;
  /* Melhorar experiência mobile */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Prevenir zoom em inputs no iOS */
  -webkit-text-size-adjust: 100%;
  /* Safe areas para dispositivos com notch */
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

/* Melhorar experiência mobile */
html {
  /* Prevenir scroll horizontal */
  overflow-x: hidden;
  /* Melhorar scroll no iOS */
  -webkit-overflow-scrolling: touch;
}

/* Esconder scrollbar em mobile */
@media (max-width: 768px) {
  ::-webkit-scrollbar {
    display: none;
  }
  * {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
}

/* ---------- Topo ---------- */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 20px; position:sticky; top:0; z-index:10;
  background:var(--bg); border-bottom:1px solid var(--border);
  backdrop-filter: blur(6px);
  /* Safe area para dispositivos com notch */
  padding-top: max(14px, env(safe-area-inset-top) + 8px);
  padding-left: max(20px, env(safe-area-inset-left) + 16px);
  padding-right: max(20px, env(safe-area-inset-right) + 16px);
}
.brand{ display:flex; align-items:center; gap:10px; font-weight:600; }
.logo-img{ height:32px; display:block; }
.actions{ display:flex; gap:10px; }

/* ---------- Navegação (tabs) ---------- */
.nav-tabs{ display:flex; align-items:center; gap:6px; margin-right:10px; }
.nav-tabs .tab{
  width:auto; padding:8px 10px; border-radius:10px; border:1px solid var(--border);
  background:transparent; color:var(--text);
}
.nav-tabs .tab.active{ background:var(--primary); border-color:var(--primary); color:#fff; }

/* ---------- Status de Sincronização ---------- */
.sync-status{
  display:flex; align-items:center; gap:6px; font-size:13px; color:var(--muted);
  padding:4px 8px; border-radius:8px; background:rgba(0,0,0,.05);
}
.sync-indicator{ font-size:14px; }
.sync-text{ font-weight:500; }

/* ---------- Login ---------- */
#login-screen{
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  /* Safe area para dispositivos com notch */
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.login-card{
  width:min(380px, 92vw);
  background:var(--card); border:1px solid var(--border); border-radius:16px;
  box-shadow:var(--shadow); padding:24px; display:flex; flex-direction:column; gap:14px; text-align:center;
  /* Melhorar experiência mobile */
  margin: 20px;
}
.login-card img{ height:54px; margin:0 auto 8px; display:block; }
.login-card h1{ margin:0 0 6px; font-size:20px; }
.login-card .muted{ color:var(--muted); font-size:13px; }

/* ---------- Dashboard ---------- */
.dashboard{
  max-width:1150px; margin:18px auto 0; padding:14px 16px;
  display:grid; gap:12px; grid-template-columns:repeat(4,1fr);
  background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow);
}
.dash-item{
  border:1px solid var(--border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:6px; background:rgba(0,0,0,.02);
}
.dash-item span{ color:var(--muted); font-size:14px; }
.dash-item strong{ font-size:20px; }

/* ---------- Layout ---------- */
.grid{
  max-width:1150px; margin:18px auto; padding:0 16px;
  display:grid; gap:24px; grid-template-columns:1fr 1fr;
}
.card{
  background:var(--card); border:1px solid var(--border); border-radius:16px;
  box-shadow:var(--shadow); padding:18px;
}
.card h2{ margin:0; }
.card-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.with-toggle button.small{ padding:6px 8px; border-radius:10px; }

/* collapsible */
.collapsible{ overflow:hidden; transition:max-height .25s ease; }
.collapsible.open{ max-height:2000px; }
.collapsible:not(.open){ max-height:0; border-top:1px dashed var(--border); }

/* ---------- Inputs & Buttons ---------- */
.row{ display:grid; grid-template-columns:1fr; gap:10px; margin:12px 0; }
.row-2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.stack{ display:flex; flex-direction:column; gap:10px; }

input, textarea, select, button{
  width:100%; padding:10px 12px; border-radius:12px;
  border:1px solid var(--border); background:transparent; color:var(--text);
}
textarea{ min-height:84px; resize:vertical; }
input:focus, textarea:focus, select:focus{
  outline:none; border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(37,211,102,.2);
}

button{ border:none; cursor:pointer; font-weight:600; }
button.primary{ background:var(--primary); color:#fff; }
button.ghost{ background:transparent; border:1px solid var(--border); }
button.danger{ background:var(--danger); color:#fff; }
.checkbox{ display:flex; align-items:center; gap:8px; }

/* ---------- Clientes ---------- */
.client{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px; border:1px solid var(--border); border-radius:12px; background:rgba(0,0,0,.02);
}
.client .meta{ display:flex; flex-direction:column; gap:4px; }
.client .meta small{ color:var(--muted); display:flex; align-items:center; gap:8px; }
.client .meta a.wa{
  display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px;
  background:rgba(37,211,102,.12); border:1px solid rgba(37,211,102,.35); text-decoration:none; color:inherit;
}
.client .meta a.wa svg{ width:16px; height:16px; display:block; }

.client .actions{ display:flex; gap:6px; }

/* ---------- Filtros ---------- */
.filters{
  display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:10px; margin:8px 0 14px;
}

/* ---------- Jobs (compactos + expansíveis) ---------- */
.job{
  border:1px solid var(--border); border-radius:12px; background:rgba(0,0,0,.02);
  padding:0; overflow:hidden;
}
.job-header{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 12px; cursor:pointer; user-select:none;
}
.job.open .job-header{ border-bottom:1px dashed var(--border); }
.job-title{
  display:flex; align-items:center; gap:8px; font-weight:600;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.job-meta{
  display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end;
}
.badge{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); }
.badge.prio-low{ background:var(--prio-low); border-color:var(--prio-low-border); }
.badge.prio-med{ background:var(--prio-med); border-color:var(--prio-med-border); }
.badge.prio-high{ background:var(--prio-high); border-color:var(--prio-high-border); }
.badge.deadline{ background:rgba(0,0,0,.05); }
.badge.pay-unpaid{ background:#fff0f0; border-color:#ff8585; }
.badge.pay-half{ background:#fff8e6; border-color:#ffce73; }
.badge.pay-paid{ background:#eaffe8; border-color:#77d78b; }

.job-actions{ display:flex; gap:6px; }
.job-actions button{ width:auto; }

/* conteúdo expandido */
.job-content{
  border-top:1px dashed var(--border);
  padding:10px 12px; display:none;
}
.job.open .job-content{ display:block; }

/* Steps */
.steps{ display:flex; flex-direction:column; gap:6px; margin-top:8px; }
.step{ display:flex; align-items:center; gap:8px; }
.step .step-text{ flex:1; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:rgba(0,0,0,.02); min-height:36px; }
.step.done .step-text{ text-decoration:line-through; opacity:.6; }
.step .remove-step{ width:auto; padding:6px 8px; border-radius:10px; border:1px solid var(--border); }
.step .move-up, .step .move-down{ width:auto; padding:6px 8px; border-radius:10px; border:1px solid var(--border); }

/* Steps summary (leitura) */
.steps-summary{ margin:8px 0 6px; padding-left:18px; }
.steps-summary li{ margin:4px 0; }

/* Price row inside job */
.job-price{
  margin:8px 0; padding:10px 12px; border:1px solid var(--border); border-radius:10px;
  background:rgba(0,0,0,.03); font-weight:600;
}

/* Drag & drop */
.droplist .job{ cursor:grab; }
.droplist .job.dragging{ opacity:.6; }
.placeholder{ height:8px; border:2px dashed var(--border); border-radius:8px; margin:6px 0; }

/* ---------- Calendário ---------- */
.calendar-card .calendar-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
.cal-actions{ display:flex; align-items:center; gap:10px; }
#cal-month{ min-width:200px; text-align:center; font-weight:600; }
.calendar{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; border-top:1px solid var(--border); padding-top:8px; }
.day{ min-height:96px; border:1px solid var(--border); border-radius:12px; padding:6px; display:flex; flex-direction:column; gap:4px; cursor:pointer; background:rgba(0,0,0,.02); }
.day .d{ font-size:12px; color:var(--muted); }
.day-list{ margin-top:10px; border-top:1px dashed var(--border); padding-top:10px; }
.day-list .item{ padding:8px; border:1px solid var(--border); border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; gap:8px; }

/* ---------- Modal ---------- */
.modal{ border:none; border-radius:16px; padding:0; width:min(760px, 96vw); background:var(--card); color:var(--text); }
.modal::backdrop{ background:rgba(0,0,0,.45); }
.modal-body{ padding:16px; }
.modal-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }

/* ---------- Relatório ---------- */
.report-grid{ display:grid; grid-template-columns:280px 1fr; gap:16px; margin-top:8px; }
.metrics{ display:grid; gap:10px; }
.metric{ border:1px solid var(--border); border-radius:12px; padding:10px; background:rgba(0,0,0,.02); display:flex; flex-direction:column; gap:4px; }
.table-wrap{ overflow:auto; border:1px solid var(--border); border-radius:12px; }
#report-table{ width:100%; border-collapse:collapse; }
#report-table th,#report-table td{ padding:8px 10px; border-bottom:1px solid var(--border); text-align:left; }
.chart-wrap{ border:1px solid var(--border); border-radius:12px; padding:8px; }

/* Financeiro reaproveita estilo da tabela */
#fin-table{ width:100%; border-collapse:collapse; }
#fin-table th,#fin-table td{ padding:8px 10px; border-bottom:1px solid var(--border); text-align:left; }

/* ---------- Footer ---------- */
footer.footer{ text-align:center; padding:18px; color:var(--muted); }

/* ---------- Responsivo ---------- */
@media (max-width:980px){
  .grid{ grid-template-columns:1fr; }
  .dashboard{ grid-template-columns:1fr 1fr; }
  .report-grid{ grid-template-columns:1fr; }
  .filters{ grid-template-columns:1fr 1fr; }
  
  /* Melhorar navegação mobile */
  .nav-tabs{ 
    flex-wrap: wrap; 
    gap: 4px; 
    margin-right: 8px; 
  }
  .nav-tabs .tab{
    padding: 6px 8px; 
    font-size: 13px;
    white-space: nowrap;
  }
  
  /* Ajustar topbar mobile */
  .topbar{ 
    padding: 10px 12px; 
    flex-wrap: wrap; 
    gap: 8px; 
  }
  .actions{ 
    flex-wrap: wrap; 
    gap: 6px; 
    justify-content: flex-end;
  }
  .actions button{ 
    padding: 6px 8px; 
    font-size: 13px;
  }
  
  /* Melhorar cards mobile */
  .card{ 
    padding: 14px; 
    margin-bottom: 16px; 
  }
  
  /* Ajustar jobs mobile */
  .job-header{ 
    padding: 8px 10px; 
    flex-wrap: wrap; 
    gap: 6px; 
  }
  .job-title{ 
    font-size: 14px; 
    flex: 1; 
    min-width: 0; 
  }
  .job-meta{ 
    flex-wrap: wrap; 
    gap: 4px; 
  }
  .badge{ 
    font-size: 11px; 
    padding: 3px 6px; 
  }
  
  /* Melhorar steps mobile */
  .step{ 
    flex-wrap: wrap; 
    gap: 6px; 
  }
  .step .step-text{ 
    padding: 6px 8px; 
    font-size: 14px; 
    min-height: 32px; 
  }
  .step .remove-step, 
  .step .move-up, 
  .step .move-down{ 
    padding: 4px 6px; 
    font-size: 12px; 
  }
  
  /* Ajustar inputs mobile */
  input, textarea, select, button{ 
    padding: 8px 10px; 
    font-size: 14px; 
  }
  .row-2{ 
    grid-template-columns: 1fr; 
  }
  
  /* Melhorar dashboard mobile */
  .dashboard{ 
    padding: 12px; 
    gap: 8px; 
  }
  .dash-item{ 
    padding: 10px; 
  }
  .dash-item strong{ 
    font-size: 18px; 
  }
}

@media (max-width:640px){
  .dashboard{ grid-template-columns:1fr; }
  .filters{ grid-template-columns:1fr; }
  
  /* Layout mobile mais compacto */
  .grid{ 
    padding: 0 12px; 
    gap: 16px; 
  }
  
  /* Topbar mobile compacta */
  .topbar{ 
    padding: 8px 10px; 
  }
  .brand{ 
    font-size: 14px; 
  }
  .logo-img{ 
    height: 28px; 
  }
  
  /* Navegação mobile mais compacta */
  .nav-tabs{ 
    margin-right: 6px; 
  }
  .nav-tabs .tab{ 
    padding: 5px 7px; 
    font-size: 12px; 
  }
  
  /* Ajustar sync status mobile */
  .sync-status{ 
    font-size: 12px; 
    padding: 3px 6px; 
  }
  
  /* Cards mobile mais compactos */
  .card{ 
    padding: 12px; 
    border-radius: 12px; 
  }
  
  /* Jobs mobile mais compactos */
  .job-header{ 
    padding: 6px 8px; 
  }
  .job-content{ 
    padding: 8px 10px; 
  }
  
  /* Steps mobile mais compactos */
  .steps{ 
    gap: 4px; 
  }
  .step .step-text{ 
    padding: 5px 7px; 
    font-size: 13px; 
    min-height: 28px; 
  }
  
  /* Modal mobile */
  .modal{ 
    width: 95vw; 
    margin: 10px; 
  }
  .modal-body{ 
    padding: 12px; 
  }
  
  /* Tabelas mobile */
  .table-wrap{ 
    font-size: 12px; 
  }
  #report-table th, #report-table td,
  #fin-table th, #fin-table td{ 
    padding: 6px 8px; 
  }
  
  /* Calendário mobile */
  .calendar{ 
    gap: 4px; 
  }
  .day{ 
    min-height: 80px; 
    padding: 4px; 
  }
  
  /* Login mobile */
  .login-card{ 
    padding: 20px; 
    margin: 10px; 
  }
}

/* Melhorias específicas para telas muito pequenas */
@media (max-width:480px){
  .topbar{ 
    flex-direction: column; 
    align-items: stretch; 
    gap: 10px; 
  }
  .actions{ 
    justify-content: center; 
  }
  .nav-tabs{ 
    justify-content: center; 
    margin-right: 0; 
  }
  
  /* Dashboard em coluna única */
  .dashboard{ 
    grid-template-columns: 1fr; 
    gap: 10px; 
  }
  
  /* Jobs em layout mais vertical */
  .job-meta{ 
    justify-content: flex-start; 
    margin-top: 4px; 
  }
  
  /* Steps em layout mais vertical */
  .step{ 
    flex-direction: column; 
    align-items: stretch; 
  }
  .step .step-text{ 
    order: 1; 
  }
  .step .remove-step, 
  .step .move-up, 
  .step .move-down{ 
    order: 2; 
    align-self: flex-end; 
  }
}

/* Melhorias de acessibilidade e usabilidade mobile */
@media (max-width:768px){
  /* Aumentar área de toque */
  button, input, select, textarea{ 
    min-height: 44px; 
  }
  
  /* Melhorar contraste em mobile */
  .badge{ 
    font-weight: 600; 
  }
  
  /* Melhorar espaçamento de toque */
  .job-actions button{ 
    min-width: 44px; 
    min-height: 44px; 
  }
  
  /* Melhorar legibilidade */
  .job-title{ 
    line-height: 1.3; 
  }
  
  /* Melhorar feedback visual */
  .step .step-text:focus{ 
    box-shadow: 0 0 0 2px var(--primary); 
  }
  
  /* Melhorar experiência de scroll */
  .grid, .card, .dashboard {
    scroll-behavior: smooth;
  }
  
  /* Prevenir seleção de texto em botões */
  button {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Melhorar feedback de toque */
  button:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  /* Melhorar inputs em mobile */
  input, textarea, select {
    font-size: 16px; /* Prevenir zoom no iOS */
  }
}

/* Melhorias para mobile nos steps */
@media (max-width:768px) {
  .steps{ gap:8px; margin-top:10px; }
  .step{ 
    gap:6px; 
    align-items: stretch; 
  }
  .step .step-text{ 
    padding:10px 12px; 
    min-height:44px; 
    font-size:14px;
    line-height:1.4;
  }
  .step .remove-step, 
  .step .move-up, 
  .step .move-down{ 
    padding:8px 10px; 
    min-width:44px;
    min-height:44px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  
  /* Melhorar feedback visual em mobile */
  .step .step-text:focus{ 
    box-shadow: 0 0 0 2px var(--primary); 
    border-color: var(--primary);
  }
  
  /* Melhorar contraste dos botões em mobile */
  .step .remove-step:hover{ 
    background: var(--danger); 
    color: white; 
    border-color: var(--danger);
  }
  .step .move-up:hover, 
  .step .move-down:hover{ 
    background: var(--primary); 
    color: white; 
    border-color: var(--primary);
  }
}
